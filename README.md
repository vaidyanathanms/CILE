## Prerequisites: 
- [fftool](https://github.com/paduagroup/fftool/tree/master)

- [clandp](https://github.com/paduagroup/clandp/tree/master) 

- [PACKMOL](https://github.com/m3g/packmol)

## Setting up a new system

For the example, I am considering c4c1im as organic cation and ntf2 as anion.

Step-1: `cd CILE`
where CILE is the main directory where the source codes are installed

Step-2: `cd src_gmx/make_itp_from_fftool`

Step-3: Either edit `gen_itp_pdb.sh` and run for each moiety in the system or follow Steps-3(a)-8 for each moiety.
`gen_itp_pdb.sh` is a shell script that automates Steps-3(a) - 8.

Step-3(a): Convert organic cation zmat (in clandp directory) to xyz and copy to current directory.

`/path/to/fftool/fftool 1 /path/to/clandp/c4c1im.zmat 0 /path/to/clandp/ntf2.zmat --rho 1.0
cp /path/to/clandp/c4c1im.xyz .`

Step-3(b): Use packmol to create `simbox.xyz` and then use `fftool` to create `config.pdb` and `field.top`
```
/path/to/packmol/packmol < pack.inp

/path/to/fftool/fftool 1 ~/tools/clandp/ntf2.zmat -r 1 -g

cp config.pdb c4c1im.pdb

cp field.top c4c1im.top
```

Step-4: Same as step-3(a) and 3(b) for anion
```
/path/to/fftool/fftool 1 /path/to/clandp/ntf2.zmat --rho 1.0

cp /path/to/clandp/ntf2.xyz .

/path/to/packmol/packmol < pack.inp

/path/to/fftool/fftool 1 ~/tools/clandp/ntf2.zmat -r 1 -g

cp config.pdb ntf2.pdb

cp field.top ntf2.top
```

Step-4b (Optional) Copy `*.pdb` to `allcoord_files` directory for backup
```
cp ntf2.pdb ../allcoord_files/

cp c4c1im.pdb ../allcoord_files/
```

Step-5: In the `make_itp_from_fftool`, create a directory with the name of the moeity and move all the files generated by `fftool` to this directory. `gen_itp_pdb.sh` automatically creates this.

Step-6: Use CHARMM-GUI or LigParGen to create the diluent and Lithium pdb/top

Step-7a: In the `src_gmx/itp_files` directory, create a new directory for each system. For example,
`mkdir -p BMIm_TFSI_BTFE`
 
Step-7b: Copy all required itp files here. 

### __IMPORTANT__ Steps 8 and 9 are very important!

Step-8: Scale the charges in the `[ atom ]` directive by copying to an Excel sheet (manual work for now - to be automated)

Step-9: Comment the `[ atomtypes ]` and `[ defaults ]` section in the `*itp` files and copy the atomtypes to `ffSCALEDcharges.itp` and `ffUNSCALEDcharges.itp`

Step-10: Create a `.top` file. Make sure the paths are consistent in the $WORKDIR as well.

Step-11: Go to packmol folder and edit the packmol script

`cd ../../src_pack`

Step-8: Edit the paths to input xyz files and output files
Edit `make_mixture.inp` with the right values for box size and anion/cation/organic cation details.

## Running GROMACS

Step-1: Create a sub-directory `itp_files` and copy all the `*.itp` for the corresponding system

Step-2: Copy the `*.top` file from `src_gmx/itp_files/DIRNAME/top` to the main directory and rename it as `topol.top`

Step-3: Copy all the run scripts `CILE/src_sh/run_preprocess.sh` and `CILE/src_sh/run_md.sh`

Step-4: Make sure the box sizes are correct

Step-5: Run the systems

